---
import { getCollection } from "astro:content";
import { getCollectionName, getEntryURL } from "@/utils/content";
interface Params {
  slug: string;
}

const { slug } = Astro.params as unknown as Params;

const [collection, name] = slug.split("/");

const collectionName = getCollectionName(collection);

if (!collectionName) {
  return Astro.redirect(`/404?from=${slug}`);
}

const postFound = await getCollection(collectionName, ({ id }) => id.includes(name));

if (!postFound.length) {
  return Astro.redirect(`/404?from=${slug}`);
}

return Astro.redirect(getEntryURL(collectionName, postFound[0].slug));
---
