---
import {
  isSupportedLang,
  LANGUAGES,
  getLocalizedPage,
  useTranslation,
  type Language,
  type PageName,
} from "@/utils/i18n";
import { slugToCanonical } from "@/utils/content";
import Layout from "@/layouts/WithHeader.astro";
import ContactForm from "@/components/forms/ContactForm";

interface Props {
  frontmatter: AboutFrontmatter;
}

interface AboutFrontmatter {
  lang: Language;
  title: string;
  description: string;
}

const PAGE = "contact" satisfies PageName;

const { frontmatter } = Astro.props;
const { lang } = frontmatter;

if (!isSupportedLang(lang)) {
  return Astro.redirect(`/404?from=${Astro.url.pathname}`);
}

const { origin } = Astro.url;
const translations = LANGUAGES.filter(l => l !== lang).map(language => ({
  lang: language,
  slug: slugToCanonical(getLocalizedPage(language, PAGE), origin),
}));

const canonical = slugToCanonical(getLocalizedPage(lang, PAGE), origin);
const t = useTranslation(lang);
---

<Layout lang={lang} canonical={canonical} description={t("page_descriptions", PAGE)} title={t("navigation", PAGE)}>
  <Fragment slot="head">
    {translations.map(translation => <link rel="alternate" href={translation.slug} hreflang={translation.lang} />)}
  </Fragment>
  <main class="h-full min-h-screen">
    <div class="h-full min-h-screen w-full">
      <div class="grid h-full min-h-screen items-center gap-4 lg:grid-cols-2">
        <div class="h-full items-center bg-blue-200 px-6 py-4 dark:bg-slate-950 sm:px-8 lg:py-12 xl:p-32">
          <div class="prose grid h-full items-center dark:prose-invert xl:prose-lg">
            <div class="container">
              <h1 class="text-5xl text-blue-800 dark:text-blue-100">{frontmatter.title}</h1>
              <p class="m-0 text-xl text-slate-600 dark:text-slate-400">{frontmatter.description}</p>
              <slot />
            </div>
          </div>
        </div>
        <div class="px-6 py-4 sm:px-8 lg:py-12 xl:px-24">
          <ContactForm client:idle action="/api/contact" lang={lang} />
        </div>
      </div>
    </div>
  </main>
</Layout>
