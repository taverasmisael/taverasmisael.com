---
import { Image, getImage } from "astro:assets";
import { relative } from "path";

interface Props {
  src: string;
  alt: string;
  caption?: string;
}

const { src, alt, caption } = Astro.props;
let image: { src: string; attributes: Record<string, unknown> };

console.log({src})
try {
  const source = relative("../", src);
  image = await getImage({ src: ((await import(source)) as typeof import("*.jpg")).default });
} catch (e) {
  console.error(e);
  image = { src, attributes: {} };
}
---

<figure>
  {
    image.attributes.width ? (
      <Image
        src={image.src}
        alt={alt || ""}
        width={image.attributes.width as number}
        height={image.attributes.height as number}
      />
    ) : (
      <img src={image.src} alt={alt || ""} />
    )
  }
  <figcaption><slot /></figcaption>
</figure>
